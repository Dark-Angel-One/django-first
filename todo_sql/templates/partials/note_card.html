<div class="note-card relative group rounded-lg border border-gray-200 dark:border-gray-700 p-4 transition-all hover:shadow-md cursor-default flex flex-col justify-between
    {% if note.color == 'red' %}bg-red-100 dark:bg-red-900{% elif note.color == 'orange' %}bg-orange-100 dark:bg-orange-900{% elif note.color == 'yellow' %}bg-yellow-100 dark:bg-yellow-900{% elif note.color == 'green' %}bg-green-100 dark:bg-green-900{% elif note.color == 'teal' %}bg-teal-100 dark:bg-teal-900{% elif note.color == 'blue' %}bg-blue-100 dark:bg-blue-900{% elif note.color == 'darkblue' %}bg-indigo-100 dark:bg-indigo-900{% elif note.color == 'purple' %}bg-purple-100 dark:bg-purple-900{% elif note.color == 'pink' %}bg-pink-100 dark:bg-pink-900{% elif note.color == 'brown' %}bg-amber-100 dark:bg-amber-900{% elif note.color == 'gray' %}bg-gray-100 dark:bg-gray-800{% else %}bg-white dark:bg-keep-bg-dark{% endif %}"
    data-id="{{ note.id }}">

    <!-- Pin Icon -->
    <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 {% if note.is_pinned %}opacity-100{% endif %} transition-opacity z-10">
        <button onclick="event.stopPropagation(); togglePinNote({{ note.id }})" class="p-1 rounded-full hover:bg-black/10 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300">
            <span class="material-symbols-outlined text-[20px] {% if note.is_pinned %}fill-1{% endif %}">keep</span>
        </button>
    </div>

    <div onclick="openEditModal({{ note.id }})" class="cursor-pointer flex-1">
        {% if note.title %}
            <h3 class="font-medium text-lg mb-2 text-gray-900 dark:text-gray-100 break-words pr-6">{{ note.title }}</h3>
        {% endif %}

        {% if note.is_checklist %}
            <ul class="space-y-1">
                {% for item in note.checklist_items.all|slice:":5" %}
                    <li class="flex items-start gap-2 text-sm text-gray-800 dark:text-gray-200">
                        <span class="material-symbols-outlined text-[18px] text-gray-400 cursor-pointer" onclick="event.stopPropagation(); toggleCheckbox({{ item.id }}, this)">
                            {% if item.is_checked %}check_box{% else %}check_box_outline_blank{% endif %}
                        </span>
                        <span class="{% if item.is_checked %}line-through text-gray-500{% endif %} break-all">{{ item.text }}</span>
                    </li>
                {% endfor %}
                {% if note.checklist_items.count > 5 %}
                    <li class="text-xs text-gray-500 pl-7">+ {{ note.checklist_items.count|add:"-5" }} more items</li>
                {% endif %}
            </ul>
        {% else %}
            <p class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap break-words max-h-60 overflow-hidden">{{ note.content|truncatechars:300 }}</p>
        {% endif %}

        {% if note.reminder_date %}
        <div class="mt-2">
             <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-500">
                <span class="material-symbols-outlined text-[14px] mr-1">schedule</span>
                {{ note.reminder_date|date:"M j, H:i" }}
             </span>
        </div>
        {% endif %}

        {% if note.labels.all %}
        <div class="flex flex-wrap gap-1 mt-2">
            {% for label in note.labels.all %}
            <span class="px-2 py-0.5 rounded-full bg-black/5 dark:bg-white/10 text-xs text-gray-700 dark:text-gray-300 cursor-pointer" onclick="event.stopPropagation(); window.location.href='/label/{{ label.name }}/'">{{ label.name }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- Hover Actions -->
    <div class="flex justify-between items-center mt-4 opacity-0 group-hover:opacity-100 transition-opacity h-8">
        <div class="flex gap-1">
            {% if note.is_trashed %}
                <button class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 text-gray-600 dark:text-gray-300" title="Delete Forever" onclick="event.stopPropagation(); deleteNoteForever({{ note.id }})">
                    <span class="material-symbols-outlined text-[18px]">delete_forever</span>
                </button>
                <button class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 text-gray-600 dark:text-gray-300" title="Restore" onclick="event.stopPropagation(); trashNote({{ note.id }})">
                    <span class="material-symbols-outlined text-[18px]">restore_from_trash</span>
                </button>
            {% else %}
                {% if note.is_archived %}
                    <button class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 text-gray-600 dark:text-gray-300" title="Unarchive" onclick="event.stopPropagation(); archiveNote({{ note.id }})">
                        <span class="material-symbols-outlined text-[18px]">unarchive</span>
                    </button>
                {% else %}
                    <button class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 text-gray-600 dark:text-gray-300" title="Archive" onclick="event.stopPropagation(); archiveNote({{ note.id }})">
                        <span class="material-symbols-outlined text-[18px]">archive</span>
                    </button>
                {% endif %}
                <button class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 text-gray-600 dark:text-gray-300" title="Trash" onclick="event.stopPropagation(); trashNote({{ note.id }})">
                    <span class="material-symbols-outlined text-[18px]">delete</span>
                </button>
            {% endif %}
        </div>
    </div>
</div>
